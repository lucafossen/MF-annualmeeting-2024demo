<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>System Usability Scale questionnaire</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
        <style>
            #susForm {
                max-width: 90%;
                margin: 0 auto;
                padding: 20px;
            }
            /* Overlay styling similar to article.html */
            #susInstructionsOverlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: none; /* hidden by default */
                background-color: rgba(0, 0, 0, 0.7);
                z-index: 9999;
            }
            .overlay-content {
                background-color: #fff;
                width: 80%;
                max-width: 600px;
                margin: 10% auto;
                padding: 20px;
                border-radius: 8px;
                text-align: left;
            }
            .overlay-content button {
                display: inline-block;
                margin-top: 20px;
                background-color: #0077cc;
                color: white;
                padding: 10px 20px;
                border-radius: 5px;
                border: none;
                cursor: pointer;
            }
            .overlay-content button:hover {
                background-color: #005fa3;
            }
        </style>
    </head>
<body>

<!-- Overlay for explaining SUS (similar to the instructions overlay in article.html) -->
<div id="susInstructionsOverlay">
    <div class="overlay-content">
        <h2>Velkommen til System Usability Scale (SUS)</h2>
        <p>
            SUS er et anerkjent spørreskjema for å måle brukervennligheten av et system.
            <br><br>
            Du vil få <b>10</b> korte spørsmål om din opplevelse av å bruke nettsiden.
            Hvert spørsmål besvares på en skala fra <b>1</b> til <b>5</b> (1 - Ikke enig i det hele tatt, 5 - Helt enig).
            <br><br>
            Dine svar hjelper oss med å skille mellom mangler i anbefalingene og mangler i brukergrensesnittet.
        </p>
        <p>
            Takk for at du har tatt deg tiden i dag — dette er svært nyttig for oss!
        </p>
        <button onclick="hideSUSOverlay()">Fortsett til SUS</button>
    </div>
</div>

<div style="margin-left: 5%;">
<button
type="button"
class="btn"
onclick="window.history.back()"
style="margin-left: 0px;">
Tilbake
</button>
    <h1>System Usability Scale Undersøkelse</h1>
    <p>Vennligst svar på følgende spørsmål om din opplevelse med å bruke systemet vårt.</p>
</div>
<form action="{{ url_for('sus') }}" method="post" id="susForm">
    <div class="question-section">
        <!-- Age Question -->
        <div class="question">
            <label for="age"><b>Alder:</b></label>
            <input type="number" id="age" name="age" min="0" required>
        </div>

        <!-- Gender Question -->
        <div class="question">
            <label for="gender"><b>Kjønn:</b></label>
            <select id="gender" name="gender" required>
                <option value="" disabled selected>Velg ditt kjønn</option>
                <option value="female">Kvinne</option>
                <option value="male">Mann</option>
                <option value="non_binary">Ikke-binær</option>
                <option value="prefer_not_to_say">Foretrekker å ikke si</option>
            </select>
        </div>
        <hr>

        <!-- SUS Questions -->
        {% for q_num, q_text in [
            (1, 'Jeg tror at jeg ville likt å bruke dette systemet ofte.'),
            (2, 'Jeg syntes systemet var unødvendig komplekst.'),
            (3, 'Jeg syntes systemet var lett å bruke.'),
            (4, 'Jeg tror at jeg ville trengt støtte fra en teknisk person for å kunne bruke dette systemet.'),
            (5, 'Jeg syntes de ulike funksjonene i dette systemet var godt integrert.'),
            (6, 'Jeg syntes det var for mye inkonsistens i dette systemet.'),
            (7, 'Jeg vil tro at de fleste mennesker ville lært å bruke dette systemet veldig raskt.'),
            (8, 'Jeg syntes systemet var veldig tungvint å bruke.'),
            (9, 'Jeg følte meg veldig trygg på å bruke systemet.'),
            (10, 'Jeg trengte å lære mange ting før jeg kunne komme i gang med dette systemet.')
        ] %}
            {% with question_number=q_num, question_text=q_text, question_name='sus_question' ~ q_num %}
                {% include 'partials/sus_question_template.html' %}
            {% endwith %}
        {% endfor %}
        <!-- Free-text section for additional feedback -->
        <div class="question" style="text-align: center;">
            <br>
            <label for="additional_feedback"><b>Har du andre tilbakemeldinger?</b></label>
            <br>
            <textarea
                id="additional_feedback"
                name="additional_feedback"
                rows="4"
                cols="50"
                placeholder="Skriv ned dine generelle tilbakemeldinger her..."
            ></textarea>
        </div>
        <button type="submit" class="btn">Send inn</button>
    </div>


</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Show overlay on the first visit, storing a separate key so it doesn't conflict with article.html
    if (!localStorage.getItem('shownOverlaySUS')) {
        document.getElementById('susInstructionsOverlay').style.display = 'block';
    }

    // Load any saved values from localStorage
    if (localStorage.getItem('susFormData')) {
        const savedData = JSON.parse(localStorage.getItem('susFormData'));

        // Restore age
        if (savedData.age) {
            document.getElementById('age').value = savedData.age;
        }

        // Restore gender
        if (savedData.gender) {
            document.getElementById('gender').value = savedData.gender;
        }

        // Restore SUS question answers
        for (let i = 1; i <= 10; i++) {
            const savedAnswer = savedData['sus_question' + i];
            if (savedAnswer) {
                // Check the corresponding radio
                const radioToCheck = document.querySelector(`input[name="sus_question${i}"][value="${savedAnswer}"]`);
                if (radioToCheck) {
                    radioToCheck.checked = true;
                }
            }
        }

        // Restore additional feedback if present
        if (savedData.additional_feedback) {
            document.getElementById('additional_feedback').value = savedData.additional_feedback;
        }
    }

    // Listen for changes in the form
    const formElements = document.querySelectorAll('#susForm input, #susForm select, #susForm textarea');
    formElements.forEach(element => {
        element.addEventListener('change', saveFormData);
    });
});

// Hide the SUS overlay and set localStorage to prevent re-showing on subsequent visits
function hideSUSOverlay() {
    document.getElementById('susInstructionsOverlay').style.display = 'none';
    localStorage.setItem('shownOverlaySUS', 'true');
}

function saveFormData() {
    // Gather form data in an object
    const formData = {
        age: document.getElementById('age').value,
        gender: document.getElementById('gender').value
    };

    // Add each question's chosen radio button value
    for (let i = 1; i <= 10; i++) {
        const chosenOption = document.querySelector(`input[name="sus_question${i}"]:checked`);
        formData['sus_question' + i] = chosenOption ? chosenOption.value : null;
    }

    // Add the additional free-text feedback
    formData.additional_feedback = document.getElementById('additional_feedback').value;

    // Save to localStorage
    localStorage.setItem('susFormData', JSON.stringify(formData));
}
</script>

</body>
<CURRENT_CURSOR_POSITION>
</html>